<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>L'Ascenseur</title>

<style>
* {
 box-sizing: border-box;
}

html, body {
 margin: 0;
 padding: 0;
 width: 100%;
 overflow-x: hidden;
 font-family: system-ui, sans-serif;
 background: var(--bg);
}

:root {
 --bg: #f6f7fb;
 --primary: #4f46e5;
 --danger: #dc2626;
 --card: #fff;
}

body {
 padding: 16px 16px 120px;
 max-width: 100vw;
}

h1, h2 {
 text-align: center;
 margin: 0 0 16px 0;
}

.card {
 background: var(--card);
 border-radius: 16px;
 padding: 16px;
 margin: 16px auto;
 max-width: min(900px, 100vw - 32px);
 box-shadow: 0 10px 25px rgba(0,0,0,.1);
 width: 100%;
}

button {
 background: var(--primary);
 color: #fff;
 border: none;
 padding: 12px;
 border-radius: 14px;
 font-size: 15px;
 font-weight: 700;
 cursor: pointer;
 min-height: 44px;
 width: 100%;
 touch-action: manipulation;
}

button.secondary {
 background: #e5e7eb;
 color: #111;
}

button.small-reset {
 width: 48px;
 height: 48px;
 padding: 0;
 min-height: 48px;
 font-size: 20px;
 flex-shrink: 0;
}

input {
 width: 100%;
 padding: 12px;
 border-radius: 12px;
 border: 1px solid #ccc;
 text-align: center;
 font-size: 18px;
 font-weight: 600;
 background: #f9fafb;
}

input.readonly {
 pointer-events: none;
}

input.names-input {
 background: white;
 pointer-events: auto;
}

.setup-section {
 display: flex;
 justify-content: center;
 align-items: center;
 gap: 16px;
 flex-wrap: wrap;
 margin: 16px 0;
}

.setup-group {
 text-align: center;
}

.setup-group label {
 display: block;
 font-weight: 700;
 margin-bottom: 8px;
 font-size: 14px;
}

.setup-group span {
 font-size: 24px;
 font-weight: 800;
 display: block;
 margin: 8px 0;
}

.setup-buttons {
 display: flex;
 gap: 8px;
}

.setup-buttons button {
 width: 48px;
 height: 48px;
 padding: 0;
 font-size: 20px;
 min-height: 44px;
}

.stepper {
 display: flex;
 align-items: center;
 justify-content: center;
 gap: 12px;
 margin-top: 8px;
 width: 100%;
}

.stepper-btn {
 width: 48px;
 height: 48px;
 border-radius: 12px;
 font-size: 20px;
 font-weight: 800;
 display: flex;
 align-items: center;
 justify-content: center;
 min-height: 44px;
 touch-action: manipulation;
 flex-shrink: 0;
}

.stepper-btn.secondary {
 background: #e5e7eb;
 color: #111;
}

.stepper-btn:disabled {
 opacity: 0.5;
 cursor: not-allowed;
}

.player-card {
 border: 1px solid #e5e7eb;
 border-radius: 14px;
 padding: 16px;
 margin-bottom: 12px;
 width: 100%;
}

.player-header {
 text-align: center;
 font-weight: 700;
 font-size: 16px;
 margin-bottom: 12px;
}

.player-inputs {
 display: grid;
 grid-template-columns: 1fr 1fr;
 gap: 12px;
 justify-items: center;
 width: 100%;
}

.player-input-group {
 width: 100%;
 text-align: center;
}

.player-total {
 text-align: center;
 font-weight: 700;
 margin-top: 12px;
 font-size: 18px;
 color: var(--primary);
}

#actionBar {
 position: fixed;
 bottom: 0;
 left: 0;
 right: 0;
 background: #fff;
 padding: 10px;
 box-shadow: 0 -5px 20px rgba(0,0,0,.15);
 display: flex;
 gap: 10px;
 width: 100%;
 max-width: 100vw;
 box-sizing: border-box;
}

#actionBar .main {
 flex: 1;
}

#dealerAlert {
 position: fixed;
 inset: 0;
 background: rgba(0,0,0,.6);
 display: flex;
 align-items: center;
 justify-content: center;
 z-index: 99;
 animation: fadeIn .3s;
 width: 100vw;
}

.alert-card {
 background: white;
 padding: 30px;
 border-radius: 20px;
 font-size: 28px;
 font-weight: 900;
 color: var(--danger);
 animation: shake .5s infinite;
 max-width: 90vw;
 margin: 0 5vw;
 text-align: center;
}

@keyframes shake {
 0% { transform: rotate(-2deg) }
 50% { transform: rotate(2deg) }
 100% { transform: rotate(-2deg) }
}

@keyframes fadeIn {
 from { opacity: 0 }
 to { opacity: 1 }
}

.rank {
 display: flex;
 justify-content: space-between;
 padding: 10px;
 border-bottom: 1px solid #eee;
 font-weight: 700;
 width: 100%;
}

small {
 display: block;
 opacity: 0.7;
 font-size: 12px;
 margin-top: 4px;
}

@media (max-width: 480px) {
 .player-inputs {
   grid-template-columns: 1fr;
   gap: 16px;
 }
 .card {
   margin: 8px 4px;
   padding: 12px;
 }
 .setup-section {
   flex-direction: column;
   gap: 20px;
 }
}
</style>
</head>

<body>

<h1>üé¥ L'Ascenseur</h1>

<div class="card" id="setup">
 <h2>Configuration</h2>
 
 <div class="setup-section">
  <div class="setup-group">
   <label>Nombre de joueurs</label>
   <div class="setup-buttons">
    <button onclick="chgPlayers(-1)">‚àí</button>
    <span id="nbPlayers" style="width:60px">4</span>
    <button onclick="chgPlayers(1)">+</button>
   </div>
  </div>
  
  <div class="setup-group">
   <label>Manches maximales</label>
   <div class="setup-buttons">
    <button onclick="chgManches(-1)">‚àí</button>
    <span id="nbManches" style="width:60px">5</span>
    <button onclick="chgManches(1)">+</button>
   </div>
  </div>
 </div>
 
 <br>
 <button onclick="names()">Continuer</button>
</div>

<div id="names"></div>
<div id="game"></div>
<div id="end"></div>

<div id="actionBar" style="display:none">
 <button class="main" id="mainBtn" onclick="action()"></button>
 <button class="secondary small-reset" onclick="reset()">‚ôªÔ∏è</button>
</div>

<script>
let nbPlayers = 4, maxManches = 5, joueurs = [], scores = [], paris = [], plis = [];
let totalParis = [], manche = 1, sens = 1, dealer = 0, parisOK = false;

// cache DOM elements
const nbPlayersSpan  = document.getElementById("nbPlayers");
const nbManchesSpan  = document.getElementById("nbManches");
const setupDiv       = document.getElementById("setup");
const namesDiv       = document.getElementById("names");
const gameDiv        = document.getElementById("game");
const endDiv         = document.getElementById("end");
const actionBar      = document.getElementById("actionBar");
const mainBtn        = document.getElementById("mainBtn");

function chgPlayers(d){
 nbPlayers = Math.min(20, Math.max(2, nbPlayers + d));
 nbPlayersSpan.innerText = nbPlayers;
}

function chgManches(d){
 maxManches = Math.min(15, Math.max(3, maxManches + d));
 nbManchesSpan.innerText = maxManches;
}

function names(){
 setupDiv.style.display = "none";
 let h = `<div class="card"><h2>Noms des joueurs</h2>`;
 for(let i=0;i<nbPlayers;i++){
   h += `<input id="n${i}" class="names-input" placeholder="Joueur ${i+1}"><br><br>`;
 }
 h += `<button onclick="start()">D√©marrer</button></div>`;
 namesDiv.innerHTML = h;
}

function start(){
 joueurs = [];
 for(let i=0;i<nbPlayers;i++){
   const input = document.getElementById(`n${i}`);
   joueurs.push((input && input.value.trim()) || `Joueur ${i+1}`);
 }
 scores     = Array(nbPlayers).fill(0);
 totalParis = Array(nbPlayers).fill(0);
 paris      = Array(nbPlayers).fill(0);
 plis       = Array(nbPlayers).fill(0);

 namesDiv.style.display = "none";
 actionBar.style.display = "flex";
 manche = 1;
 sens = 1;
 dealer = 0;
 parisOK = false;
 draw();
}

function updateValue(idx, type, delta){
 const val = type === 'pari' ? paris[idx] : plis[idx];
 const maxVal = manche;
 const newVal = Math.max(0, Math.min(maxVal, val + delta));
 if(type === 'pari') paris[idx] = newVal;
 else plis[idx] = newVal;
 draw();
}

function draw(){
 let h = `<div class="card"><h2>Manche ${manche}</h2>
          <p style="text-align:center">üÉè Dealer : <b>${joueurs[dealer]}</b></p>`;
 joueurs.forEach((j,i)=>{
   const pariVal = paris[i];
   const plisVal = plis[i];
   const pariRead = parisOK ? 'readonly' : '';
   const plisRead = !parisOK ? 'readonly' : '';
   h += `<div class="player-card">
     <div class="player-header">${j}${i===dealer?" üÉè":""}</div>
     <div class="player-inputs">
       <div class="player-input-group">
         <div class="stepper">
           <button class="stepper-btn secondary" onclick="updateValue(${i},'pari',-1)" ${pariVal<=0||pariRead ? 'disabled' : ''}>‚àí</button>
           <input type="number" readonly value="${pariVal}" class="readonly ${pariRead}">
           <button class="stepper-btn secondary" onclick="updateValue(${i},'pari',1)" ${pariVal>=manche||pariRead ? 'disabled' : ''}>+</button>
         </div>
         <small>Paris</small>
       </div>
       <div class="player-input-group">
         <div class="stepper">
           <button class="stepper-btn secondary" onclick="updateValue(${i},'plis',-1)" ${plisVal<=0||plisRead ? 'disabled' : ''}>‚àí</button>
           <input type="number" readonly value="${plisVal}" class="readonly ${plisRead}">
           <button class="stepper-btn secondary" onclick="updateValue(${i},'plis',1)" ${plisVal>=manche||plisRead ? 'disabled' : ''}>+</button>
         </div>
         <small>Plis</small>
       </div>
     </div>
     <div class="player-total">Score : ${scores[i]}</div>
   </div>`;
 });
 gameDiv.innerHTML = h + "</div>";
 mainBtn.innerText = parisOK ? "Terminer la manche" : "Valider les paris";
}

function action(){
 parisOK ? next() : checkParis();
}

function checkParis(){
 let sum = 0;
 joueurs.forEach((_,i)=>{ sum += paris[i]; totalParis[i] += paris[i]; });
 if(sum === manche){
  document.body.insertAdjacentHTML("beforeend",
   `<div id="dealerAlert"><div class="alert-card">TU PEUX PAAAAAAS üòà</div></div>`);
  setTimeout(()=>{
    const da = document.getElementById("dealerAlert");
    if (da) da.remove();
  },1500);
  return;
 }
 parisOK = true;
 draw();
}

function next(){
 joueurs.forEach((_,i)=>{
  scores[i] += (paris[i] === plis[i])
    ? 10 * (plis[i] + 1)
    : -10 * Math.abs(paris[i] - plis[i]);
 });
 paris.fill(0);
 plis.fill(0);
 parisOK = false;
 dealer = (dealer + 1) % joueurs.length;
 if(manche === maxManches) sens = -1;
 manche += sens;
 if(manche === 0) return endGame();
 draw();
}

function endGame(){
 actionBar.style.display = "none";
 let ranked = [...joueurs.keys()].sort((a,b)=>scores[b]-scores[a]);
 let h = `<div class="card"><h2>üèÜ Classement final</h2>`;
 ranked.forEach((i,r)=>{
  h += `<div class="rank">
   <span>${["ü•á","ü•à","ü•â"][r]||"üé¥"} ${joueurs[i]}</span>
   <span>${scores[i]} pts | Paris : ${totalParis[i]}</span>
  </div>`;
 });
 endDiv.innerHTML = h + "</div>";
}

function reset(){
 if(confirm("Nouvelle partie ?")) location.reload();
}
</script>

</body>
</html>
