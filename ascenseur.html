<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>L‚ÄôAscenseur</title>

<style>
:root {
  --bg:#f6f7fb;
  --primary:#4f46e5;
  --danger:#dc2626;
  --card:#fff;
  --muted:#9ca3af;
}

body {
  font-family: system-ui, sans-serif;
  background: var(--bg);
  margin:0;
  padding:20px 20px 80px;
}

h1,h2 { text-align:center; }

.card {
  background:var(--card);
  border-radius:14px;
  padding:20px;
  margin:20px auto;
  max-width:1100px;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
}

button {
  background:var(--primary);
  color:#fff;
  border:none;
  padding:12px 18px;
  border-radius:10px;
  cursor:pointer;
  font-weight:600;
}

button.danger { background:var(--danger); }

table {
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}

th,td {
  padding:8px;
  border-bottom:1px solid #e5e7eb;
  text-align:center;
}

th { background:#eef2ff; }

input {
  width:70px;
  padding:6px;
  border-radius:6px;
  border:1px solid #d1d5db;
  text-align:center;
}

input.readonly {
  background:#f3f4f6;
  color:#111827;
  font-weight:600;
}

input[readonly] {
  cursor:not-allowed;
}

.dealer {
  font-weight:700;
  color:var(--primary);
}

#resetBar {
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  background:white;
  box-shadow:0 -5px 20px rgba(0,0,0,.1);
  padding:10px;
  display:flex;
  justify-content:center;
}
</style>
</head>

<body>

<h1>üé¥ L‚ÄôAscenseur</h1>

<div class="card" id="setup">
  <h2>Nouvelle partie</h2>
  <label>Nombre de joueurs :</label>
  <input type="number" id="nbJoueurs" min="2" max="6" value="4">
  <button onclick="setupNames()">Continuer</button>
</div>

<div id="names"></div>
<div id="game"></div>
<div id="recap"></div>

<div id="resetBar" style="display:none">
  <button class="danger" onclick="resetGame()">üîÑ R√©initialiser la partie</button>
</div>

<script>
let joueurs=[], scores=[], manches=[];
let manche=1, sens=1, dealerIndex=0;
let parisValides=false;
const maxCartes=5;

function setupNames(){
  const nb=+document.getElementById("nbJoueurs").value;
  document.getElementById("setup").style.display="none";

  let html=`<div class="card"><h2>Noms des joueurs</h2>`;
  for(let i=0;i<nb;i++){
    html+=`<p>Joueur ${i+1} :
      <input id="name${i}" placeholder="Nom"></p>`;
  }
  html+=`<button onclick="startGame(${nb})">D√©marrer</button></div>`;
  document.getElementById("names").innerHTML=html;
}

function startGame(nb){
  joueurs=[];
  for(let i=0;i<nb;i++){
    joueurs.push(document.getElementById("name"+i).value || "Joueur "+(i+1));
  }
  document.getElementById("names").style.display="none";
  document.getElementById("resetBar").style.display="flex";

  scores=Array(nb).fill(0);
  manches=[];
  manche=1;
  sens=1;
  dealerIndex=0;
  parisValides=false;
  renderGame();
}

function renderGame(){
  let html=`<div class="card">
    <h2>Manche ${manche} carte(s)</h2>
    <p>üÉè Dealer : <span class="dealer">${joueurs[dealerIndex]}</span></p>
    <table>
      <tr>
        <th>Joueur</th>
        <th>Pari</th>
        <th>Plis</th>
        <th>Total</th>
      </tr>`;

  joueurs.forEach((j,i)=>{
    html+=`
    <tr>
      <td>${j}${i===dealerIndex?" üÉè":""}</td>
      <td>
        <input id="pari${i}" type="number" min="0" max="${manche}"
        ${parisValides?"readonly class='readonly'":""}>
      </td>
      <td>
        <input id="pli${i}" type="number" min="0" max="${manche}"
        ${!parisValides?"readonly class='readonly'":""}>
      </td>
      <td>${scores[i]}</td>
    </tr>`;
  });

  html+=`</table><br>`;

  html+= !parisValides
    ? `<button onclick="validerParis()">Valider les paris</button>`
    : `<button onclick="validerManche()">Valider la manche</button>`;

  html+=`</div>`;
  document.getElementById("game").innerHTML=html;
  renderRecap();
}

function validerParis(){
  let somme=0;
  joueurs.forEach((_,i)=>{
    if(i!==dealerIndex){
      somme+=+document.getElementById("pari"+i).value||0;
    }
  });

  let dealerPari=+document.getElementById("pari"+dealerIndex).value||0;

  if(somme+dealerPari===manche){
    alert("‚ùå Tu peux paaaaaaaaas !");
    return;
  }

  parisValides=true;
  renderGame();
}

function validerManche(){
  let recap={manche,scores:[]};

  joueurs.forEach((_,i)=>{
    let pari=+document.getElementById("pari"+i).value||0;
    let pli=+document.getElementById("pli"+i).value||0;
    let score= pari===pli ? 10*(pli+1) : -10*Math.abs(pari-pli);
    scores[i]+=score;
    recap.scores.push(score);
  });

  manches.push(recap);
  parisValides=false;
  dealerIndex=(dealerIndex+1)%joueurs.length;

  if(manche===maxCartes) sens=-1;
  manche+=sens;

  if(manche===0){
    alert("üéâ Partie termin√©e !");
    return;
  }
  renderGame();
}

function resetGame(){
  if(confirm("R√©initialiser compl√®tement la partie ?")){
    location.reload();
  }
}

function renderRecap(){
  if(!manches.length) return;
  let html=`<div class="card"><h2>R√©cap des manches</h2><table>
    <tr><th>Manche</th>${joueurs.map(j=>`<th>${j}</th>`).join("")}</tr>`;
  manches.forEach(m=>{
    html+=`<tr><td>${m.manche}</td>${m.scores.map(s=>`<td>${s}</td>`).join("")}</tr>`;
  });
  html+=`</table></div>`;
  document.getElementById("recap").innerHTML=html;
}
</script>

</body>
</html>
